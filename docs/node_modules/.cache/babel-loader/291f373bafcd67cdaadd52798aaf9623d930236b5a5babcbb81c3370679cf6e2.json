{"ast":null,"code":"var _jsxFileName = \"D:\\\\Uni\\\\ba\\\\BA_webboard\\\\cafe\\\\src\\\\component\\\\PostDetailPage.js\",\n  _s = $RefreshSig$();\n// src/components/PostDetailPage.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport supabase from './connect'; // Adjust the import based on your project structure\nimport '../style/PostDetail.css'; // Import CSS file - ensure this file exists at this path\n\n// --- Helper Functions ---\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst formatDate = (dateString, includeTime = false) => {\n  if (!dateString) return '';\n  const options = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    ...(includeTime && {\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  };\n  return new Date(dateString).toLocaleDateString(undefined, options);\n};\nconst getAllImageUrls = post => {\n  const urls = [];\n  if (!post) return urls;\n  let imagesProcessedFromPostImageArray = false;\n  if (post.post_image) {\n    if (typeof post.post_image === 'string' && post.post_image.startsWith('[') && post.post_image.endsWith(']')) {\n      try {\n        const parsedImages = JSON.parse(post.post_image);\n        if (Array.isArray(parsedImages)) {\n          parsedImages.forEach(url => {\n            if (typeof url === 'string' && url.trim() !== '') urls.push(url.trim());\n          });\n          imagesProcessedFromPostImageArray = true;\n        } else if (typeof post.post_image === 'string' && post.post_image.trim() !== '') {\n          urls.push(post.post_image.trim());\n        }\n      } catch (e) {\n        if (typeof post.post_image === 'string' && post.post_image.trim() !== '') {\n          urls.push(post.post_image.trim());\n        }\n      }\n    } else if (typeof post.post_image === 'string' && post.post_image.trim() !== '') {\n      urls.push(post.post_image.trim());\n    }\n  }\n  if (!imagesProcessedFromPostImageArray) {\n    if (post.post_image_2 && typeof post.post_image_2 === 'string' && post.post_image_2.trim() !== '') {\n      urls.push(post.post_image_2.trim());\n    }\n    if (post.post_image_3 && typeof post.post_image_3 === 'string' && post.post_image_3.trim() !== '') {\n      urls.push(post.post_image_3.trim());\n    }\n  }\n  return urls;\n};\n// --- End Helper Functions ---\n\nconst PostDetailPage = ({\n  checklogin,\n  userData\n}) => {\n  _s();\n  var _post$user;\n  const {\n    postId\n  } = useParams();\n  const [post, setPost] = useState(null);\n  const [loadingPost, setLoadingPost] = useState(true);\n  const [error, setError] = useState(null);\n  const [isUpdatingVotes, setIsUpdatingVotes] = useState(false);\n  const [userVote, setUserVote] = useState({\n    liked: false,\n    disliked: false\n  });\n\n  // --- Comments State ---\n  const [comments, setComments] = useState([]);\n  const [loadingComments, setLoadingComments] = useState(true);\n  const [newCommentText, setNewCommentText] = useState('');\n  const [isSubmittingComment, setIsSubmittingComment] = useState(false);\n\n  // Fetch post details\n  useEffect(() => {\n    const fetchPostDetails = async () => {\n      if (!postId) return;\n      setLoadingPost(true);\n      setError(null);\n      try {\n        const {\n          data,\n          error: fetchError\n        } = await supabase.from('post').select(`\n            *,\n            user ( username )\n          `).eq('post_id', postId).single();\n        if (fetchError) throw fetchError;\n        if (!data) throw new Error('Post not found');\n        console.log('Post data:', data); // Debug: log the retrieved post\n        setPost(data);\n        const storedVote = localStorage.getItem(`post-${postId}-vote`);\n        if (storedVote) setUserVote(JSON.parse(storedVote));\n      } catch (err) {\n        console.error('Error fetching post details:', err);\n        setError(err.message || 'Failed to load post.');\n      } finally {\n        setLoadingPost(false);\n      }\n    };\n    fetchPostDetails();\n  }, [postId]);\n\n  // Fetch comments\n  const fetchComments = useCallback(async () => {\n    if (!postId) return;\n    setLoadingComments(true);\n    try {\n      // Simplified query to avoid join issues\n      const {\n        data,\n        error: commentsError\n      } = await supabase.from('comment').select('*').eq('post_id', postId);\n      // .order('created_at', { ascending: true });\n\n      if (commentsError) throw commentsError;\n      console.log('Comments data:', data); // Debug: log the retrieved comments\n\n      // Now fetch user details separately for each comment\n      const commentsWithUsers = await Promise.all((data || []).map(async comment => {\n        if (!comment.user_id) return {\n          ...comment,\n          user: null\n        };\n        const {\n          data: userData,\n          error: userError\n        } = await supabase.from('user').select('username').eq('user_id', comment.user_id).single();\n        if (userError) {\n          console.error('Error fetching user for comment:', userError);\n          return {\n            ...comment,\n            user: null\n          };\n        }\n        return {\n          ...comment,\n          user: userData\n        };\n      }));\n      setComments(commentsWithUsers || []);\n    } catch (err) {\n      console.error('Error fetching comments:', err);\n    } finally {\n      setLoadingComments(false);\n    }\n  }, [postId]);\n  useEffect(() => {\n    fetchComments();\n  }, [fetchComments]);\n  const handleVote = async voteType => {\n    if (!post || isUpdatingVotes) return;\n    setIsUpdatingVotes(true);\n    const currentLikes = post.post_like || 0;\n    const currentDislikes = post.post_dislike || 0;\n    let newLikes = currentLikes;\n    let newDislikes = currentDislikes;\n    let newUserVote = {\n      ...userVote\n    };\n    const originalPostState = {\n      ...post\n    };\n    const originalUserVoteState = {\n      ...userVote\n    };\n    if (voteType === 'like') {\n      if (userVote.liked) {\n        newLikes = currentLikes - 1;\n        newUserVote.liked = false;\n      } else {\n        newLikes = currentLikes + 1;\n        newUserVote.liked = true;\n        if (userVote.disliked) {\n          newDislikes = currentDislikes - 1;\n          newUserVote.disliked = false;\n        }\n      }\n    } else if (voteType === 'dislike') {\n      if (userVote.disliked) {\n        newDislikes = currentDislikes - 1;\n        newUserVote.disliked = false;\n      } else {\n        newDislikes = currentDislikes + 1;\n        newUserVote.disliked = true;\n        if (userVote.liked) {\n          newLikes = currentLikes - 1;\n          newUserVote.liked = false;\n        }\n      }\n    }\n    setPost(p => ({\n      ...p,\n      post_like: Math.max(0, newLikes),\n      post_dislike: Math.max(0, newDislikes)\n    }));\n    setUserVote(newUserVote);\n    localStorage.setItem(`post-${postId}-vote`, JSON.stringify(newUserVote));\n    try {\n      const {\n        error: updateError\n      } = await supabase.from('post').update({\n        post_like: Math.max(0, newLikes),\n        post_dislike: Math.max(0, newDislikes)\n      }).eq('post_id', postId);\n      if (updateError) throw updateError;\n    } catch (err) {\n      console.error(`Error updating post vote:`, err);\n      setPost(originalPostState);\n      setUserVote(originalUserVoteState);\n      localStorage.setItem(`post-${postId}-vote`, JSON.stringify(originalUserVoteState));\n      alert(`Failed to update vote. Please try again.`);\n    } finally {\n      setIsUpdatingVotes(false);\n    }\n  };\n  const handleSubmitComment = async e => {\n    e.preventDefault();\n    if (!newCommentText.trim()) {\n      alert(\"Comment cannot be empty\");\n      return;\n    }\n    if (!checklogin || !userData) {\n      alert(\"You must be logged in to comment\");\n      return;\n    }\n    if (!postId) {\n      alert(\"Post ID is missing\");\n      return;\n    }\n    setIsSubmittingComment(true);\n    console.log(\"Submitting comment with user:\", userData);\n    try {\n      var _userData$email;\n      // First, insert the comment\n      const {\n        data: newComment,\n        error: insertError\n      } = await supabase.from('comment').insert({\n        post_id: postId,\n        user_id: userData.user_id,\n        comment_detail: newCommentText.trim(),\n        comment_like: 0,\n        comment_dislike: 0\n      }).select();\n      if (insertError) throw insertError;\n      console.log(\"Comment inserted:\", newComment);\n      if (!Array.isArray(newComment) || newComment.length === 0) {\n        throw new Error(\"Comment was inserted but no data was returned\");\n      }\n\n      // Add the new comment to the current state\n      const commentWithUser = {\n        ...newComment[0],\n        user: {\n          username: userData.username || ((_userData$email = userData.email) === null || _userData$email === void 0 ? void 0 : _userData$email.split('@')[0]) || 'User'\n        }\n      };\n\n      // Add to comments state\n      setComments(prevComments => [...prevComments, commentWithUser]);\n      setNewCommentText('');\n\n      // Update post's comment_count\n      if (post) {\n        const {\n          error: countError\n        } = await supabase.from('post').update({\n          comment_count: (post.comment_count || 0) + 1\n        }).eq('post_id', postId);\n        if (countError) {\n          console.error(\"Error updating post comment count:\", countError);\n        } else {\n          setPost(prevPost => ({\n            ...prevPost,\n            comment_count: (prevPost.comment_count || 0) + 1\n          }));\n        }\n      }\n    } catch (err) {\n      console.error('Error submitting comment:', err);\n      alert('Failed to submit comment: ' + (err.message || 'Unknown error'));\n    } finally {\n      setIsSubmittingComment(false);\n    }\n  };\n  if (loadingPost) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"loadingError\",\n    children: \"Loading post details...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 247,\n    columnNumber: 27\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"loadingError\",\n    children: [\"Error: \", error, \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 248,\n    columnNumber: 21\n  }, this);\n  if (!post) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"loadingError\",\n    children: \"Post not found.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 249,\n    columnNumber: 21\n  }, this);\n  const authorDisplayName = ((_post$user = post.user) === null || _post$user === void 0 ? void 0 : _post$user.username) || `User ID: ${post.user_id ? post.user_id.substring(0, 8) : 'N/A'}...`;\n  const allImageUrls = getAllImageUrls(post);\n\n  // Helper to display commenter name\n  const getCommenterName = commentUser => {\n    if (!commentUser) return 'Anonymous';\n    return commentUser.username || 'User';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"title\",\n      children: post.post_title || 'Untitled Post'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"meta\",\n      children: [\"By \", authorDisplayName, \" \\u2022 Published on \", formatDate(post.created_at)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }, this), post.post_region && /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"regionTag\",\n      children: post.post_region\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 28\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"description\",\n      children: post.post_detail || 'No description available.'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 7\n    }, this), allImageUrls.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"imageGrid\",\n      children: [\" \", allImageUrls.map((url, index) => /*#__PURE__*/_jsxDEV(\"img\", {\n        src: url,\n        alt: `${post.post_title || 'Post'} image ${index + 1}`,\n        className: \"postImage\"\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 100\n      }, this)), \" \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 36\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"imageGrid\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"imagePlaceholder\",\n        children: \"No Images Available\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 252\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 225\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"actions\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: `actionItem ${userVote.liked ? 'activeVote' : ''} ${isUpdatingVotes ? 'disabledButton' : ''}`,\n        onClick: () => !isUpdatingVotes && handleVote('like'),\n        role: \"button\",\n        tabIndex: 0,\n        onKeyPress: e => {\n          if (!isUpdatingVotes && (e.key === 'Enter' || e.key === ' ')) handleVote('like');\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"actionButton\",\n          disabled: isUpdatingVotes,\n          children: [\"\\uD83D\\uDC4D \", post.post_like || 0]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `actionItem ${userVote.disliked ? 'activeDislike' : ''} ${isUpdatingVotes ? 'disabledButton' : ''}`,\n        onClick: () => !isUpdatingVotes && handleVote('dislike'),\n        role: \"button\",\n        tabIndex: 0,\n        onKeyPress: e => {\n          if (!isUpdatingVotes && (e.key === 'Enter' || e.key === ' ')) handleVote('dislike');\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"actionButton\",\n          disabled: isUpdatingVotes,\n          children: [\"\\uD83D\\uDC4E \", post.post_dislike || 0]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"actionItem\",\n        children: [\"\\uD83D\\uDCAC \", comments.length > 0 ? comments.length : post.comment_count || 0, \" Comments\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"commentsSection\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"commentsTitle\",\n        children: [\"Comments (\", comments.length > 0 ? comments.length : post.comment_count || 0, \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }, this), checklogin ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmitComment,\n        className: \"commentForm\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"loggedInAs\",\n          children: [\"Posting as: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: (userData === null || userData === void 0 ? void 0 : userData.username) || 'User'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 51\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"commentTextarea\",\n          value: newCommentText,\n          onChange: e => setNewCommentText(e.target.value),\n          placeholder: \"Write a comment...\",\n          rows: \"3\",\n          disabled: isSubmittingComment\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: `commentSubmitButton ${isSubmittingComment ? 'commentSubmitButtonDisabled' : ''}`,\n          disabled: isSubmittingComment,\n          children: isSubmittingComment ? 'Submitting...' : 'Submit Comment'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loginPrompt\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Please \", /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/login\",\n            children: \"log in\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 23\n          }, this), \" to post a comment.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"loginNote\",\n          children: \"(Already logged in? Try refreshing the page.)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 11\n      }, this), loadingComments && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading comments...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 29\n      }, this), !loadingComments && comments.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"noComments\",\n        children: \"No comments yet. Be the first to comment!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 11\n      }, this), !loadingComments && comments.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: comments.map(comment => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"comment\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"commentAuthor\",\n            children: getCommenterName(comment.user)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"commentDate\",\n            children: formatDate(comment.created_at, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"commentText\",\n            children: comment.comment_detail\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"commentActions\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"commentActionItem\",\n              children: [\"\\uD83D\\uDC4D \", comment.comment_like || 0]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"commentActionItem\",\n              children: [\"\\uD83D\\uDC4E \", comment.comment_dislike || 0]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 17\n          }, this)]\n        }, comment.comment_id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      to: \"/\",\n      className: \"backLink\",\n      children: \"\\u2190 Back to Home\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 262,\n    columnNumber: 5\n  }, this);\n};\n_s(PostDetailPage, \"rcPK0uHFu3mOcdWAfUh1m7HDVEY=\", false, function () {\n  return [useParams];\n});\n_c = PostDetailPage;\nexport default PostDetailPage;\nvar _c;\n$RefreshReg$(_c, \"PostDetailPage\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useParams","Link","supabase","jsxDEV","_jsxDEV","formatDate","dateString","includeTime","options","year","month","day","hour","minute","Date","toLocaleDateString","undefined","getAllImageUrls","post","urls","imagesProcessedFromPostImageArray","post_image","startsWith","endsWith","parsedImages","JSON","parse","Array","isArray","forEach","url","trim","push","e","post_image_2","post_image_3","PostDetailPage","checklogin","userData","_s","_post$user","postId","setPost","loadingPost","setLoadingPost","error","setError","isUpdatingVotes","setIsUpdatingVotes","userVote","setUserVote","liked","disliked","comments","setComments","loadingComments","setLoadingComments","newCommentText","setNewCommentText","isSubmittingComment","setIsSubmittingComment","fetchPostDetails","data","fetchError","from","select","eq","single","Error","console","log","storedVote","localStorage","getItem","err","message","fetchComments","commentsError","commentsWithUsers","Promise","all","map","comment","user_id","user","userError","handleVote","voteType","currentLikes","post_like","currentDislikes","post_dislike","newLikes","newDislikes","newUserVote","originalPostState","originalUserVoteState","p","Math","max","setItem","stringify","updateError","update","alert","handleSubmitComment","preventDefault","_userData$email","newComment","insertError","insert","post_id","comment_detail","comment_like","comment_dislike","length","commentWithUser","username","email","split","prevComments","countError","comment_count","prevPost","className","children","fileName","_jsxFileName","lineNumber","columnNumber","authorDisplayName","substring","allImageUrls","getCommenterName","commentUser","post_title","created_at","post_region","post_detail","index","src","alt","onClick","role","tabIndex","onKeyPress","key","disabled","onSubmit","value","onChange","target","placeholder","rows","type","to","comment_id","_c","$RefreshReg$"],"sources":["D:/Uni/ba/BA_webboard/cafe/src/component/PostDetailPage.js"],"sourcesContent":["// src/components/PostDetailPage.jsx\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport supabase from './connect'; // Adjust the import based on your project structure\r\nimport '../style/PostDetail.css'; // Import CSS file - ensure this file exists at this path\r\n\r\n// --- Helper Functions ---\r\nconst formatDate = (dateString, includeTime = false) => {\r\n  if (!dateString) return '';\r\n  const options = {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n    ...(includeTime && { hour: '2-digit', minute: '2-digit' })\r\n  };\r\n  return new Date(dateString).toLocaleDateString(undefined, options);\r\n};\r\n\r\nconst getAllImageUrls = (post) => {\r\n    const urls = [];\r\n    if (!post) return urls;\r\n    let imagesProcessedFromPostImageArray = false;\r\n    if (post.post_image) {\r\n        if (typeof post.post_image === 'string' && post.post_image.startsWith('[') && post.post_image.endsWith(']')) {\r\n            try {\r\n                const parsedImages = JSON.parse(post.post_image);\r\n                if (Array.isArray(parsedImages)) {\r\n                    parsedImages.forEach(url => { if (typeof url === 'string' && url.trim() !== '') urls.push(url.trim()); });\r\n                    imagesProcessedFromPostImageArray = true;\r\n                } else if (typeof post.post_image === 'string' && post.post_image.trim() !== '') { urls.push(post.post_image.trim()); }\r\n            } catch (e) { if (typeof post.post_image === 'string' && post.post_image.trim() !== '') { urls.push(post.post_image.trim()); } }\r\n        } else if (typeof post.post_image === 'string' && post.post_image.trim() !== '') { urls.push(post.post_image.trim()); }\r\n    }\r\n    if (!imagesProcessedFromPostImageArray) {\r\n        if (post.post_image_2 && typeof post.post_image_2 === 'string' && post.post_image_2.trim() !== '') { urls.push(post.post_image_2.trim()); }\r\n        if (post.post_image_3 && typeof post.post_image_3 === 'string' && post.post_image_3.trim() !== '') { urls.push(post.post_image_3.trim()); }\r\n    }\r\n    return urls;\r\n};\r\n// --- End Helper Functions ---\r\n\r\n\r\nconst PostDetailPage = ({ checklogin, userData }) => {\r\n  const { postId } = useParams();\r\n  const [post, setPost] = useState(null);\r\n  const [loadingPost, setLoadingPost] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [isUpdatingVotes, setIsUpdatingVotes] = useState(false);\r\n  const [userVote, setUserVote] = useState({ liked: false, disliked: false });\r\n\r\n  // --- Comments State ---\r\n  const [comments, setComments] = useState([]);\r\n  const [loadingComments, setLoadingComments] = useState(true);\r\n  const [newCommentText, setNewCommentText] = useState('');\r\n  const [isSubmittingComment, setIsSubmittingComment] = useState(false);\r\n\r\n  // Fetch post details\r\n  useEffect(() => {\r\n    const fetchPostDetails = async () => {\r\n      if (!postId) return;\r\n      setLoadingPost(true);\r\n      setError(null);\r\n      try {\r\n        const { data, error: fetchError } = await supabase\r\n          .from('post')\r\n          .select(`\r\n            *,\r\n            user ( username )\r\n          `)\r\n          .eq('post_id', postId)\r\n          .single();\r\n\r\n        if (fetchError) throw fetchError;\r\n        if (!data) throw new Error('Post not found');\r\n        console.log('Post data:', data); // Debug: log the retrieved post\r\n        setPost(data);\r\n        const storedVote = localStorage.getItem(`post-${postId}-vote`);\r\n        if (storedVote) setUserVote(JSON.parse(storedVote));\r\n      } catch (err) {\r\n        console.error('Error fetching post details:', err);\r\n        setError(err.message || 'Failed to load post.');\r\n      } finally {\r\n        setLoadingPost(false);\r\n      }\r\n    };\r\n    fetchPostDetails();\r\n  }, [postId]);\r\n\r\n  // Fetch comments\r\n  const fetchComments = useCallback(async () => {\r\n    if (!postId) return;\r\n    setLoadingComments(true);\r\n    try {\r\n      // Simplified query to avoid join issues\r\n      const { data, error: commentsError } = await supabase\r\n        .from('comment')\r\n        .select('*')\r\n        .eq('post_id', postId)\r\n        // .order('created_at', { ascending: true });\r\n\r\n      if (commentsError) throw commentsError;\r\n      console.log('Comments data:', data); // Debug: log the retrieved comments\r\n      \r\n      // Now fetch user details separately for each comment\r\n      const commentsWithUsers = await Promise.all(\r\n        (data || []).map(async (comment) => {\r\n          if (!comment.user_id) return { ...comment, user: null };\r\n          \r\n          const { data: userData, error: userError } = await supabase\r\n            .from('user')\r\n            .select('username')\r\n            .eq('user_id', comment.user_id)\r\n            .single();\r\n            \r\n          if (userError) {\r\n            console.error('Error fetching user for comment:', userError);\r\n            return { ...comment, user: null };\r\n          }\r\n          \r\n          return { ...comment, user: userData };\r\n        })\r\n      );\r\n      \r\n      setComments(commentsWithUsers || []);\r\n    } catch (err) {\r\n      console.error('Error fetching comments:', err);\r\n    } finally {\r\n      setLoadingComments(false);\r\n    }\r\n  }, [postId]);\r\n\r\n  useEffect(() => {\r\n    fetchComments();\r\n  }, [fetchComments]);\r\n\r\n\r\n  const handleVote = async (voteType) => {\r\n    if (!post || isUpdatingVotes) return;\r\n    setIsUpdatingVotes(true);\r\n    const currentLikes = post.post_like || 0;\r\n    const currentDislikes = post.post_dislike || 0;\r\n    let newLikes = currentLikes;\r\n    let newDislikes = currentDislikes;\r\n    let newUserVote = { ...userVote };\r\n    const originalPostState = { ...post };\r\n    const originalUserVoteState = { ...userVote };\r\n\r\n    if (voteType === 'like') {\r\n      if (userVote.liked) { newLikes = currentLikes - 1; newUserVote.liked = false; }\r\n      else { newLikes = currentLikes + 1; newUserVote.liked = true;\r\n        if (userVote.disliked) { newDislikes = currentDislikes - 1; newUserVote.disliked = false;}\r\n      }\r\n    } else if (voteType === 'dislike') {\r\n      if (userVote.disliked) { newDislikes = currentDislikes - 1; newUserVote.disliked = false; }\r\n      else { newDislikes = currentDislikes + 1; newUserVote.disliked = true;\r\n        if (userVote.liked) { newLikes = currentLikes - 1; newUserVote.liked = false; }\r\n      }\r\n    }\r\n    setPost(p => ({...p, post_like: Math.max(0, newLikes), post_dislike: Math.max(0, newDislikes)}));\r\n    setUserVote(newUserVote);\r\n    localStorage.setItem(`post-${postId}-vote`, JSON.stringify(newUserVote));\r\n    try {\r\n      const { error: updateError } = await supabase.from('post').update({ post_like: Math.max(0, newLikes), post_dislike: Math.max(0, newDislikes) }).eq('post_id', postId);\r\n      if (updateError) throw updateError;\r\n    } catch (err) {\r\n      console.error(`Error updating post vote:`, err);\r\n      setPost(originalPostState); setUserVote(originalUserVoteState); localStorage.setItem(`post-${postId}-vote`, JSON.stringify(originalUserVoteState));\r\n      alert(`Failed to update vote. Please try again.`);\r\n    } finally { setIsUpdatingVotes(false); }\r\n  };\r\n\r\n  const handleSubmitComment = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!newCommentText.trim()) {\r\n      alert(\"Comment cannot be empty\");\r\n      return;\r\n    }\r\n    \r\n    if (!checklogin || !userData) {\r\n      alert(\"You must be logged in to comment\");\r\n      return;\r\n    }\r\n    \r\n    if (!postId) {\r\n      alert(\"Post ID is missing\");\r\n      return;\r\n    }\r\n    \r\n    setIsSubmittingComment(true);\r\n    console.log(\"Submitting comment with user:\", userData);\r\n\r\n    try {\r\n      // First, insert the comment\r\n      const { data: newComment, error: insertError } = await supabase\r\n        .from('comment')\r\n        .insert({\r\n          post_id: postId,\r\n          user_id: userData.user_id,\r\n          comment_detail: newCommentText.trim(),\r\n          comment_like: 0,\r\n          comment_dislike: 0\r\n        })\r\n        .select();\r\n\r\n      if (insertError) throw insertError;\r\n      console.log(\"Comment inserted:\", newComment);\r\n\r\n      if (!Array.isArray(newComment) || newComment.length === 0) {\r\n        throw new Error(\"Comment was inserted but no data was returned\");\r\n      }\r\n\r\n      // Add the new comment to the current state\r\n      const commentWithUser = {\r\n        ...newComment[0],\r\n        user: { username: userData.username || userData.email?.split('@')[0] || 'User' }\r\n      };\r\n\r\n      // Add to comments state\r\n      setComments(prevComments => [...prevComments, commentWithUser]);\r\n      setNewCommentText('');\r\n\r\n      // Update post's comment_count\r\n      if (post) {\r\n        const { error: countError } = await supabase\r\n          .from('post')\r\n          .update({ comment_count: (post.comment_count || 0) + 1 })\r\n          .eq('post_id', postId);\r\n          \r\n        if (countError) {\r\n          console.error(\"Error updating post comment count:\", countError);\r\n        } else {\r\n          setPost(prevPost => ({ \r\n            ...prevPost, \r\n            comment_count: (prevPost.comment_count || 0) + 1 \r\n          }));\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error submitting comment:', err);\r\n      alert('Failed to submit comment: ' + (err.message || 'Unknown error'));\r\n    } finally {\r\n      setIsSubmittingComment(false);\r\n    }\r\n  };\r\n\r\n  if (loadingPost) return <p className=\"loadingError\">Loading post details...</p>;\r\n  if (error) return <p className=\"loadingError\">Error: {error} </p>;\r\n  if (!post) return <p className=\"loadingError\">Post not found.</p>;\r\n\r\n  const authorDisplayName = post.user?.username || `User ID: ${post.user_id ? post.user_id.substring(0, 8) : 'N/A'}...`;\r\n  const allImageUrls = getAllImageUrls(post);\r\n\r\n  // Helper to display commenter name\r\n  const getCommenterName = (commentUser) => {\r\n    if (!commentUser) return 'Anonymous';\r\n    return commentUser.username || 'User';\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      {/* ... Post Title, Meta, Description, Images, Actions ... */}\r\n      <h1 className=\"title\">{post.post_title || 'Untitled Post'}</h1>\r\n      <p className=\"meta\">\r\n        By {authorDisplayName} • Published on {formatDate(post.created_at)}\r\n      </p>\r\n      {post.post_region && <span className=\"regionTag\">{post.post_region}</span>}\r\n      <div className=\"description\">{post.post_detail || 'No description available.'}</div>\r\n      {allImageUrls.length > 0 ? ( <div className=\"imageGrid\"> {allImageUrls.map((url, index) => ( <img key={index} src={url} alt={`${post.post_title || 'Post'} image ${index + 1}`} className=\"postImage\" /> ))} </div> ) : ( <div className=\"imageGrid\"><div className=\"imagePlaceholder\">No Images Available</div></div> )}\r\n      <div className=\"actions\">\r\n        <span className={`actionItem ${userVote.liked ? 'activeVote' : ''} ${isUpdatingVotes ? 'disabledButton' : ''}`} onClick={() => !isUpdatingVotes && handleVote('like')} role=\"button\" tabIndex={0} onKeyPress={(e) => { if (!isUpdatingVotes && (e.key === 'Enter' || e.key === ' ')) handleVote('like'); }}>\r\n          <button className=\"actionButton\" disabled={isUpdatingVotes}>👍 {post.post_like || 0}</button>\r\n        </span>\r\n        <span className={`actionItem ${userVote.disliked ? 'activeDislike' : ''} ${isUpdatingVotes ? 'disabledButton' : ''}`} onClick={() => !isUpdatingVotes && handleVote('dislike')} role=\"button\" tabIndex={0} onKeyPress={(e) => { if (!isUpdatingVotes && (e.key === 'Enter' || e.key === ' ')) handleVote('dislike'); }}>\r\n          <button className=\"actionButton\" disabled={isUpdatingVotes}>👎 {post.post_dislike || 0}</button>\r\n        </span>\r\n        {/* Use fetched comments length for a more reactive count */}\r\n        <span className=\"actionItem\">💬 {comments.length > 0 ? comments.length : (post.comment_count || 0)} Comments</span>\r\n      </div>\r\n\r\n      {/* --- Comments Section --- */}\r\n      <div className=\"commentsSection\">\r\n        <h2 className=\"commentsTitle\">Comments ({comments.length > 0 ? comments.length : (post.comment_count || 0)})</h2>\r\n        \r\n        {/* Comment Form */}\r\n        {checklogin ? (\r\n          <form onSubmit={handleSubmitComment} className=\"commentForm\">\r\n            <p className=\"loggedInAs\">Posting as: <strong>{userData?.username || 'User'}</strong></p>\r\n            <textarea\r\n              className=\"commentTextarea\"\r\n              value={newCommentText}\r\n              onChange={(e) => setNewCommentText(e.target.value)}\r\n              placeholder=\"Write a comment...\"\r\n              rows=\"3\"\r\n              disabled={isSubmittingComment}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              className={`commentSubmitButton ${isSubmittingComment ? 'commentSubmitButtonDisabled' : ''}`}\r\n              disabled={isSubmittingComment}\r\n            >\r\n              {isSubmittingComment ? 'Submitting...' : 'Submit Comment'}\r\n            </button>\r\n          </form>\r\n        ) : (\r\n          <div className=\"loginPrompt\">\r\n            <p>Please <Link to=\"/login\">log in</Link> to post a comment.</p>\r\n            <p className=\"loginNote\">(Already logged in? Try refreshing the page.)</p>\r\n          </div>\r\n        )}\r\n\r\n        {loadingComments && <p>Loading comments...</p>}\r\n        {!loadingComments && comments.length === 0 && (\r\n          <p className=\"noComments\">No comments yet. Be the first to comment!</p>\r\n        )}\r\n        {!loadingComments && comments.length > 0 && (\r\n          <div>\r\n            {comments.map((comment) => (\r\n              <div key={comment.comment_id} className=\"comment\">\r\n                <p className=\"commentAuthor\">\r\n                  {getCommenterName(comment.user)}\r\n                </p>\r\n                <p className=\"commentDate\">\r\n                  {formatDate(comment.created_at, true)}\r\n                </p>\r\n                <p className=\"commentText\">{comment.comment_detail}</p>\r\n                <div className=\"commentActions\">\r\n                  <span className=\"commentActionItem\">👍 {comment.comment_like || 0}</span>\r\n                  <span className=\"commentActionItem\">👎 {comment.comment_dislike || 0}</span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n      {/* --- End Comments Section --- */}\r\n\r\n      <Link to=\"/\" className=\"backLink\">← Back to Home</Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostDetailPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}